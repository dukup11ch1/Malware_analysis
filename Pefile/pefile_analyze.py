import sys
import os
import pefile
import parse_filelist
import res
import filehash
import section_E


files = parse_filelist.PEfiles(sys.argv[1])
result=[]

for pe in files:
    try:
        pf=pefile.PE(pe)
    except:
        print "may be \"" + pe + "\" is not pefile"
        continue
    
    entropy=[]
    for section in pf.sections:
        entropy.append(section_E.Ent(section.Name,section.get_entropy()))
    a= res.Res(pe,filehash.md5(open(pe)),pf.FILE_HEADER.TimeDateStamp,entropy,pf.get_imphash(),pf.OPTIONAL_HEADER.MajorLinkerVersion,pf.OPTIONAL_HEADER.SizeOfCode)
    result.append(a)
    
for a in result:
    a.print_result()


    