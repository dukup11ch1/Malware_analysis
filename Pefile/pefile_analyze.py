import sys
import os
import pefile
import parse_filelist
import res
import filehash
import section_E


#sys.argv[1]="D:\\BoB\\"
files = parse_filelist.allfiles("D:\\BoB\\")
result=[]

for pe in files:
    try:
        pf=pefile.PE(pe)
    except:
        print "may be \"" + pe + "\" is not pefile"
        continue
    a= res.Res(pe,0,0,0,0,0,0)
    a.set_hash(filehash.md5(open(pe)))
    a.set_comp(pf.FILE_HEADER.TimeDateStamp)
    entropy=[]
    for section in pf.sections:
        entropy.append(section_E.Ent(section.Name,section.get_entropy()))
    a.set_Entropy(entropy)
    a.set_imphash(pf.get_imphash())
    a.set_MLV(pf.OPTIONAL_HEADER.MajorLinkerVersion)
    a.set_codesize(pf.OPTIONAL_HEADER.SizeOfCode)
    result.append(a)
    
    
